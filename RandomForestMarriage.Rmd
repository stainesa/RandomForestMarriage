---
title: "Random Forest"
author: "Anthony Staines"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document: default
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
rm(list=ls())

library(tidyverse)
library(randomForest)
library(ranger)
library(rsample)

knitr::opts_chunk$set(echo = FALSE, cache = TRUE)
set.seed(412789)
```

# Training data

Start with the Ames housing data. This is a supervised learning example dataset, where the goal is to predict the sales price. See De Cock, D. (2011). "Ames, Iowa: Alternative to the Boston Housing Data as an End of Semester Regression Project," Journal of Statistics Education, Volume 19, Number 3.
Note that Sale_Price is directly observed, without error.

```{r}
Ames <- AmesHousing::make_ames()

```

We also use the Attrition data set, which is employee attrition information originally provided by the IBM Watson Analytics Lab. Attrition is also observed without error.

```{r}
data("attrition", package = "modeldata")
class(attrition)
Attrition <- attrition
rm(attrition)

```


# One random forest

```{r}
# number of features
n_features <- length(setdiff(names(Ames), "Sale_Price"))

# train a default random forest model
ames_rf1 <- ranger(
  Sale_Price ~ ., 
  data = Ames,
  mtry = floor(n_features / 3),
  importance = 'impurity',
  respect.unordered.factors = "order",
  seed = 123
)

# get OOB RMSE
(default_rmse <- sqrt(ames_rf1$prediction.error))
## [1] 24859.27

treeInfo(ames_rf1)#  
importance(ames_rf1)
```


# and another


```{r}
# number of features
n_features <- length(setdiff(names(Attrition), "Attrition"))

# train a default random forest model
attr_rf1 <- ranger(
  Attrition ~ ., 
  data = Attrition,
  mtry = floor(n_features / 3),
  importance = 'impurity',
  respect.unordered.factors = "order",
  seed = 123
)

# get OOB RMSE
(default_rmse <- sqrt(attr_rf1$prediction.error))
## [1] 24859.27

treeInfo(attr_rf1)#  
importance(attr_rf1)

```

```{r}

p1 <- vip::vip(attr_rf1, num_features = 25, bar = FALSE)
p2 <- vip::vip(ames_rf1, num_features = 25, bar = FALSE)
gridExtra::grid.arrange(p1, p2, nrow = 1)



```
